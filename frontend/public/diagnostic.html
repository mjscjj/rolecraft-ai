<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoleCraft AI - è¯Šæ–­é¡µé¢</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: white; text-align: center; margin-bottom: 20px; }
    .card { 
      background: white; 
      border-radius: 12px; 
      padding: 20px; 
      margin-bottom: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .test-item { 
      padding: 12px; 
      margin: 8px 0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .pass { background: #dcfce7; color: #166534; }
    .fail { background: #fee2e2; color: #991b1b; }
    .pending { background: #fef3c7; color: #92400e; }
    .icon { font-size: 20px; }
    .error-box {
      background: #fee2e2;
      color: #991b1b;
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
      font-family: monospace;
      white-space: pre-wrap;
      font-size: 12px;
    }
    .nav { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 20px;
      justify-content: center;
    }
    .nav a {
      color: white;
      text-decoration: none;
      padding: 10px 20px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
    }
    .nav a:hover { background: rgba(255,255,255,0.3); }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” RoleCraft AI è¯Šæ–­ä¸­å¿ƒ</h1>
    
    <div class="nav">
      <a href="/">ğŸ  ä¸»é¡µ</a>
      <a href="/roles">ğŸ­ è§’è‰²</a>
      <a href="/chat">ğŸ’¬ å¯¹è¯</a>
    </div>
    
    <div class="card">
      <h2>ğŸ“Š ç³»ç»Ÿè¯Šæ–­</h2>
      <div id="diagnostics">æ­£åœ¨è¿è¡Œè¯Šæ–­...</div>
    </div>
    
    <div class="card">
      <h2>ğŸ”§ ç¯å¢ƒä¿¡æ¯</h2>
      <div id="environment">æ£€æµ‹ä¸­...</div>
    </div>
    
    <div class="card">
      <h2>âŒ é”™è¯¯æ—¥å¿—</h2>
      <div id="errors">æ— é”™è¯¯</div>
    </div>
  </div>

  <script type="module">
    const results = [];
    const errors = [];
    
    function addResult(name, passed, details = '') {
      results.push({ name, passed, details });
    }
    
    function addError(source, message) {
      errors.push({ source, message, time: new Date().toLocaleTimeString() });
    }
    
    // 1. æ£€æŸ¥ DOM
    try {
      const root = document.getElementById('root');
      addResult('DOM Root å…ƒç´ ', false, 'å½“å‰æ˜¯è¯Šæ–­é¡µé¢ï¼Œéä¸»åº”ç”¨');
    } catch (e) {
      addResult('DOM æ£€æŸ¥', false, e.message);
    }
    
    // 2. æ£€æŸ¥ React
    try {
      const react = await import('/node_modules/.vite/deps/react.js?v=7d3b4c5e');
      addResult('React åŠ è½½', true, `ç‰ˆæœ¬: ${react.version || 'å·²åŠ è½½'}`);
    } catch (e) {
      addResult('React åŠ è½½', false, e.message);
      addError('React', e.message);
    }
    
    // 3. æ£€æŸ¥ React Router
    try {
      const router = await import('/node_modules/.vite/deps/react-router-dom.js?v=7d3b4c5e');
      addResult('React Router', true, 'å·²åŠ è½½');
    } catch (e) {
      addResult('React Router', false, e.message);
      addError('Router', e.message);
    }
    
    // 4. æ£€æŸ¥ä¸»åº”ç”¨
    try {
      await import('/src/main.tsx');
      addResult('ä¸»åº”ç”¨å…¥å£', true, 'åŠ è½½æˆåŠŸ');
    } catch (e) {
      addResult('ä¸»åº”ç”¨å…¥å£', false, e.message);
      addError('Main', e.message);
    }
    
    // 5. æ£€æŸ¥åç«¯ API
    try {
      const res = await fetch('http://localhost:8080/health');
      const data = await res.json();
      addResult('åç«¯ API', res.ok, `çŠ¶æ€: ${res.status}`);
    } catch (e) {
      addResult('åç«¯ API', false, 'æ— æ³•è¿æ¥');
      addError('API', e.message);
    }
    
    // 6. æ£€æŸ¥è§’è‰²æ¨¡æ¿
    try {
      const res = await fetch('http://localhost:8080/api/v1/roles/templates');
      const data = await res.json();
      const count = data.data?.length || 0;
      addResult('è§’è‰²æ¨¡æ¿', res.ok, `æ•°é‡: ${count}`);
    } catch (e) {
      addResult('è§’è‰²æ¨¡æ¿', false, e.message);
    }
    
    // æ˜¾ç¤ºç»“æœ
    const diagDiv = document.getElementById('diagnostics');
    diagDiv.innerHTML = results.map(r => `
      <div class="test-item ${r.passed ? 'pass' : 'fail'}">
        <span class="icon">${r.passed ? 'âœ…' : 'âŒ'}</span>
        <div>
          <strong>${r.name}</strong>
          ${r.details ? `<br><small>${r.details}</small>` : ''}
        </div>
      </div>
    `).join('');
    
    // æ˜¾ç¤ºç¯å¢ƒ
    const envDiv = document.getElementById('environment');
    envDiv.innerHTML = `
      <div class="test-item pending">
        <span class="icon">ğŸŒ</span>
        <div>
          <strong>æµè§ˆå™¨</strong><br>
          <small>${navigator.userAgent.split(' ').slice(-2).join(' ')}</small>
        </div>
      </div>
      <div class="test-item pending">
        <span class="icon">ğŸ“…</span>
        <div>
          <strong>æ—¶é—´</strong><br>
          <small>${new Date().toLocaleString()}</small>
        </div>
      </div>
      <div class="test-item pending">
        <span class="icon">ğŸ”—</span>
        <div>
          <strong>å½“å‰ URL</strong><br>
          <small>${window.location.href}</small>
        </div>
      </div>
    `;
    
    // æ˜¾ç¤ºé”™è¯¯
    const errorDiv = document.getElementById('errors');
    if (errors.length > 0) {
      errorDiv.innerHTML = errors.map(e => `
        <div class="error-box">
          [${e.time}] ${e.source}: ${e.message}
        </div>
      `).join('');
    } else {
      errorDiv.innerHTML = '<div class="test-item pass"><span class="icon">âœ…</span>æ— é”™è¯¯</div>';
    }
    
    // å…¨å±€é”™è¯¯æ•è·
    window.onerror = (msg, url, line, col, error) => {
      addError('Runtime', `${msg} at ${url}:${line}`);
      errorDiv.innerHTML += `<div class="error-box">[è¿è¡Œæ—¶] ${msg}</div>`;
    };
    
    window.onunhandledrejection = (event) => {
      addError('Promise', event.reason);
      errorDiv.innerHTML += `<div class="error-box">[Promise] ${event.reason}</div>`;
    };
  </script>
</body>
</html>