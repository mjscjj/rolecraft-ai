# RoleCraft AI é‡æ„è®¡åˆ’

**åŸºäº ai_base é¡¹ç›®çš„ç”¨æˆ·/å·¥ä½œåŒºéš”ç¦»æ¶æ„**

---

## ğŸ“‹ é‡æ„ç›®æ ‡

ä½¿ç”¨ **AnythingLLM Workspace** ä½œä¸ºç”¨æˆ·æ•°æ®éš”ç¦»åŸºç¡€ï¼Œé‡æ„ RoleCraft AI çš„å¯¹è¯å’ŒçŸ¥è¯†åº“æœåŠ¡ã€‚

---

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡

### 1. ç”¨æˆ·éš”ç¦»æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RoleCraft AI                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç”¨æˆ· A (user_001)          ç”¨æˆ· B (user_002)                â”‚
â”‚       â”‚                          â”‚                          â”‚
â”‚       â–¼                          â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ RoleCraftâ”‚                â”‚ RoleCraftâ”‚                    â”‚
â”‚  â”‚ Workspaceâ”‚                â”‚ Workspaceâ”‚                    â”‚
â”‚  â”‚user_001 â”‚                â”‚user_002 â”‚                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
â”‚  â”‚ è§’è‰²é…ç½® â”‚                â”‚ è§’è‰²é…ç½® â”‚                    â”‚
â”‚  â”‚ çŸ¥è¯†åº“   â”‚                â”‚ çŸ¥è¯†åº“   â”‚                    â”‚
â”‚  â”‚ å¯¹è¯å†å² â”‚                â”‚ å¯¹è¯å†å² â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚       â”‚                          â”‚                          â”‚
â”‚       â–¼                          â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚user_001.lanceâ”‚          â”‚user_002.lanceâ”‚                 â”‚
â”‚  â”‚ (AnythingLLM)â”‚          â”‚ (AnythingLLM)â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒå˜åŒ–

| æ¨¡å— | æ—§è®¾è®¡ | æ–°è®¾è®¡ |
|------|--------|--------|
| **ç”¨æˆ·éš”ç¦»** | userId å­—æ®µ | AnythingLLM Workspace |
| **çŸ¥è¯†åº“** | æœ¬åœ°æ–‡ä»¶ + SQLite | AnythingLLM å‘é‡åº“ |
| **å¯¹è¯** | æœ¬åœ° Message è¡¨ | AnythingLLM Chat API |
| **è§’è‰²** | æœ¬åœ° Role è¡¨ | Workspace é…ç½® + ç³»ç»Ÿæç¤ºè¯ |
| **å‘é‡æ£€ç´¢** | âŒ æœªå®ç° | âœ… LanceDB (å†…ç½®) |

---

## ğŸ“¦ ä¾èµ–æœåŠ¡

### AnythingLLM (è…¾è®¯äº‘ 150)

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| **API Base** | `http://150.109.21.115:3001/api` |
| **API Key** | `sk-WaUmgZsMxgeHOpp8SJxK1rmVQxiwfiDJ` |
| **LLM** | OpenRouter (GPT-4/Claude/Gemini) |
| **Embedding** | text-embedding-3-small |
| **Vector DB** | LanceDB |

---

## ğŸ”§ é‡æ„æ­¥éª¤

### é˜¶æ®µ 1: åŸºç¡€æ¶æ„ (1-2 å¤©)

#### 1.1 æ·»åŠ  AnythingLLM å®¢æˆ·ç«¯
```go
// backend/internal/service/anythingllm/client.go
type AnythingLLMClient struct {
    baseURL string
    apiKey  string
}

// æ ¸å¿ƒæ–¹æ³•
- CreateWorkspace(user_id)
- UploadDocument(user_id, file)
- Chat(user_id, message, mode)
- VectorSearch(user_id, query)
- GetChatHistory(user_id, limit)
```

#### 1.2 æ•°æ®åº“æ¨¡å‹è°ƒæ•´
```go
// ç”¨æˆ·æ¨¡å‹ - æ·»åŠ  AnythingLLM å…³è”
type User struct {
    ID              string
    Email           string
    AnythingLLMSlug string  // æ–°å¢ï¼šWorkspace slug
    CreatedAt       time.Time
}

// è§’è‰²æ¨¡å‹ - ç®€åŒ–ï¼Œç»‘å®šåˆ° Workspace
type Role struct {
    ID            string
    UserID        string
    Name          string
    SystemPrompt  string  // åŒæ­¥åˆ° AnythingLLM
    ModelConfig   JSON
}

// æ–‡æ¡£æ¨¡å‹ - åªå­˜å…ƒæ•°æ®ï¼Œå®é™…å­˜å‚¨åœ¨ AnythingLLM
type Document struct {
    ID              string
    UserID          string
    Name            string
    AnythingLLMHash string  // æ–°å¢ï¼šAnythingLLM æ–‡æ¡£ hash
    Status          string  // processing/completed/failed
}
```

#### 1.3 è¿ç§»è„šæœ¬
```bash
# ä¸ºç°æœ‰ç”¨æˆ·åˆ›å»º AnythingLLM Workspace
for user in users:
    anythingllm.create_workspace(user.id)
    user.anythingllm_slug = f"user_{user.id}"
```

---

### é˜¶æ®µ 2: å¯¹è¯æœåŠ¡é‡æ„ (1-2 å¤©)

#### 2.1 å¯¹è¯ API æ”¹é€ 
```go
// æ—§çš„ï¼šæœ¬åœ°å­˜å‚¨å¯¹è¯
POST /api/v1/chat/:id/complete
â†’ è¯»å–æœ¬åœ° Message å†å²
â†’ è°ƒç”¨ OpenAI API
â†’ ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“

// æ–°çš„ï¼šä½¿ç”¨ AnythingLLM
POST /api/v1/chat/:id/complete
â†’ è¯»å–æœ¬åœ°ä¼šè¯é…ç½® (è§’è‰²/æ¨¡å¼)
â†’ è°ƒç”¨ AnythingLLM /v1/workspace/{slug}/chat
â†’ ä¿å­˜ä¼šè¯å…ƒæ•°æ®åˆ°æœ¬åœ° (å¯é€‰)
```

#### 2.2 æ–°å¢ç«¯ç‚¹
```go
// åŒæ­¥ AnythingLLM å¯¹è¯å†å²
GET /api/v1/chat-sessions/:id/sync
â†’ ä» AnythingLLM è·å–å®Œæ•´å†å²
â†’ ç¼“å­˜åˆ°æœ¬åœ° (å¯é€‰)

// æ¸…é™¤å¯¹è¯å†å²
DELETE /api/v1/chat-sessions/:id/messages
â†’ è°ƒç”¨ AnythingLLM åˆ é™¤æ¶ˆæ¯
```

---

### é˜¶æ®µ 3: çŸ¥è¯†åº“é‡æ„ (2-3 å¤©)

#### 3.1 æ–‡æ¡£ä¸Šä¼ æ”¹é€ 
```go
// æ—§çš„ï¼šä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
POST /api/v1/documents
â†’ ä¿å­˜åˆ° ./uploads/{uuid}.pdf
â†’ è®°å½•åˆ°æ•°æ®åº“

// æ–°çš„ï¼šä¸Šä¼ åˆ° AnythingLLM
POST /api/v1/documents
â†’ ä¸´æ—¶ä¿å­˜åˆ°æœ¬åœ°
â†’ è°ƒç”¨ AnythingLLM /v1/document/upload
â†’ è°ƒç”¨ /v1/workspace/{slug}/update-embeddings
â†’ æ›´æ–°æœ¬åœ° Document çŠ¶æ€
```

#### 3.2 RAG æ£€ç´¢
```go
// AnythingLLM è‡ªåŠ¨å¤„ç† RAG
// å¯¹è¯æ—¶è‡ªåŠ¨æ£€ç´¢ç”¨æˆ· Workspace ä¸­çš„ç›¸å…³æ–‡æ¡£

// å¯é€‰ï¼šæ‰‹åŠ¨å‘é‡æœç´¢
POST /api/v1/documents/search
â†’ è°ƒç”¨ AnythingLLM /v1/workspace/{slug}/vector-search
â†’ è¿”å›ç›¸å…³ç‰‡æ®µ
```

---

### é˜¶æ®µ 4: è§’è‰²ç³»ç»Ÿå¢å¼º (1-2 å¤©)

#### 4.1 è§’è‰²ä¸ Workspace ç»‘å®š
```go
// åˆ›å»ºè§’è‰²æ—¶åŒæ­¥æ›´æ–° AnythingLLM
POST /api/v1/roles
â†’ åˆ›å»ºæœ¬åœ° Role è®°å½•
â†’ è°ƒç”¨ AnythingLLM /v1/workspace/{slug}/update
   æ›´æ–° system_prompt

// åˆ‡æ¢è§’è‰²
POST /api/v1/roles/:id/activate
â†’ æ›´æ–°ç”¨æˆ·çš„å½“å‰è§’è‰²
â†’ è°ƒç”¨ AnythingLLM æ›´æ–° Workspace é…ç½®
```

#### 4.2 å¤šè§’è‰²æ”¯æŒ
```
ç”¨æˆ· Workspace
â”œâ”€â”€ ä¸»è§’è‰² (é»˜è®¤ç³»ç»Ÿæç¤ºè¯)
â”œâ”€â”€ è§’è‰² A (è¥é”€ä¸“å®¶)
â”œâ”€â”€ è§’è‰² B (æ³•åŠ¡é¡¾é—®)
â””â”€â”€ è§’è‰² C (æŠ€æœ¯æ”¯æŒ)

// å®ç°æ–¹å¼ï¼š
- æ–¹æ¡ˆ 1: æ¯ä¸ªè§’è‰²ä¸€ä¸ª Workspace (èµ„æºæ¶ˆè€—å¤§)
- æ–¹æ¡ˆ 2: å¯¹è¯æ—¶åŠ¨æ€è¦†ç›– system_prompt (æ¨è)
```

---

## ğŸ“Š API å˜æ›´å¯¹æ¯”

### ç”¨æˆ·è®¤è¯ (ä¸å˜)
```
âœ… POST /api/v1/auth/register
âœ… POST /api/v1/auth/login
âœ… GET /api/v1/users/me
```

### è§’è‰²ç®¡ç† (å°æ”¹)
```
âœ… GET /api/v1/roles
âœ… POST /api/v1/roles
âœ… PUT /api/v1/roles/:id
âœ… DELETE /api/v1/roles/:id
   + åŒæ­¥æ›´æ–° AnythingLLM Workspace
```

### å¯¹è¯æœåŠ¡ (å¤§æ”¹)
```
âœ… POST /api/v1/chat-sessions          # åˆ›å»º AnythingLLM Workspace
âœ… GET /api/v1/chat-sessions           # åˆ—å‡ºç”¨æˆ· Workspace
âœ… GET /api/v1/chat-sessions/:id       # è·å– Workspace è¯¦æƒ…
âœ… POST /api/v1/chat/:id/complete      # â†’ AnythingLLM Chat API
âœ… POST /api/v1/chat/:id/stream        # â†’ AnythingLLM Stream API
+  GET /api/v1/chat-sessions/:id/sync  # æ–°å¢ï¼šåŒæ­¥å†å²
```

### çŸ¥è¯†åº“ (å¤§æ”¹)
```
âœ… GET /api/v1/documents               # åˆ—å‡º Workspace æ–‡æ¡£
âœ… POST /api/v1/documents              # â†’ AnythingLLM Upload
âœ… GET /api/v1/documents/:id           # è·å–æ–‡æ¡£å…ƒæ•°æ®
âœ… PUT /api/v1/documents/:id           # æ›´æ–°å…ƒæ•°æ®
âœ… DELETE /api/v1/documents/:id        # â†’ AnythingLLM Delete
+  POST /api/v1/documents/search       # æ–°å¢ï¼šå‘é‡æœç´¢
```

---

## ğŸ”’ å®‰å…¨ä¸éš”ç¦»

### æ•°æ®éš”ç¦»
- âœ… æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ Workspace
- âœ… LanceDB å‘é‡åº“ç‰©ç†éš”ç¦»
- âœ… æ–‡æ¡£å­˜å‚¨éš”ç¦»
- âœ… å¯¹è¯å†å²éš”ç¦»

### API å®‰å…¨
- âœ… JWT Token è®¤è¯ (RoleCraft)
- âœ… Bearer Token è®¤è¯ (AnythingLLM)
- âœ… ç”¨æˆ· ID â†’ Workspace Slug æ˜ å°„éªŒè¯

### æƒé™æ§åˆ¶
```go
// ä¸­é—´ä»¶éªŒè¯
func WorkspaceAuth() gin.HandlerFunc {
    return func(c *gin.Context) {
        userId := c.Get("userId")
        workspaceSlug := c.Param("slug")
        
        // éªŒè¯ slug å±äºå½“å‰ç”¨æˆ·
        if !validateOwnership(userId, workspaceSlug) {
            c.AbortWithStatus(403)
            return
        }
    }
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
```go
// ç”¨æˆ· Workspace æ˜ å°„ç¼“å­˜
cache.Set("user_workspace:"+userId, slug, 5*time.Minute)

// è§’è‰²é…ç½®ç¼“å­˜
cache.Set("role_config:"+roleId, config, 10*time.Minute)
```

### æ‰¹é‡æ“ä½œ
```go
// æ‰¹é‡ä¸Šä¼ æ–‡æ¡£
POST /api/v1/documents/batch
â†’ æ‰“åŒ…å¤šä¸ªæ–‡ä»¶
â†’ è°ƒç”¨ AnythingLLM æ‰¹é‡ä¸Šä¼ 
```

### å¼‚æ­¥å¤„ç†
```go
// æ–‡æ¡£å¤„ç†å¼‚æ­¥åŒ–
POST /api/v1/documents
â†’ ç«‹å³è¿”å› "processing"
â†’ åå° goroutine è°ƒç”¨ AnythingLLM
â†’ å®Œæˆåæ›´æ–°çŠ¶æ€
```

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- [ ] AnythingLLM Client å°è£…æµ‹è¯•
- [ ] Workspace åˆ›å»º/æ›´æ–°/åˆ é™¤æµ‹è¯•
- [ ] æ–‡æ¡£ä¸Šä¼ æµç¨‹æµ‹è¯•
- [ ] å¯¹è¯ API é›†æˆæµ‹è¯•

### é›†æˆæµ‹è¯•
- [ ] ç”¨æˆ·éš”ç¦»éªŒè¯ (A ä¸èƒ½è®¿é—® B çš„æ•°æ®)
- [ ] å‘é‡æ£€ç´¢å‡†ç¡®æ€§æµ‹è¯•
- [ ] å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡æµ‹è¯•
- [ ] è§’è‰²åˆ‡æ¢æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
- [ ] å¹¶å‘å¯¹è¯æµ‹è¯• (100 ç”¨æˆ·)
- [ ] å¤§æ‰¹é‡æ–‡æ¡£ä¸Šä¼ æµ‹è¯•
- [ ] å‘é‡æœç´¢å»¶è¿Ÿæµ‹è¯•

---

## ğŸ“… æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ |
|------|------|------|
| é˜¶æ®µ 1 | åŸºç¡€æ¶æ„ | 1-2 å¤© |
| é˜¶æ®µ 2 | å¯¹è¯æœåŠ¡é‡æ„ | 1-2 å¤© |
| é˜¶æ®µ 3 | çŸ¥è¯†åº“é‡æ„ | 2-3 å¤© |
| é˜¶æ®µ 4 | è§’è‰²ç³»ç»Ÿå¢å¼º | 1-2 å¤© |
| æµ‹è¯• | å®Œæ•´æµ‹è¯• | 1-2 å¤© |
| **æ€»è®¡** | | **6-11 å¤©** |

---

## âœ… æˆåŠŸæ ‡å‡†

- [ ] æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
- [ ] ç”¨æˆ·æ•°æ®å®Œå…¨éš”ç¦»
- [ ] å¯¹è¯å“åº”æ—¶é—´ <2s
- [ ] æ–‡æ¡£ä¸Šä¼ æˆåŠŸç‡ >99%
- [ ] å‘é‡æ£€ç´¢å‡†ç¡®ç‡ >90%
- [ ] æ”¯æŒ 100+ å¹¶å‘ç”¨æˆ·

---

**åˆ›å»ºæ—¶é—´**: 2026-02-26  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: å¾…æ‰§è¡Œ
